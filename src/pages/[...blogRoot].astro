---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Filter from "@/components/Filters/Filter";
import { CardDisplay } from "@/components/Cards/CardDisplay";
import { blogPath } from "@/lib/nav";

import { getCollection } from "astro:content";

// Get static paths
export const getStaticPaths = () => {
  return blogPath ? [{ params: { blogRoot: blogPath.path } }] : [];
};

const allWritings = (await getCollection("blog")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);

const getTags = () => {
  const postsWithTags = allWritings.filter((i) => i.data.tags);
  let tagSet = new Set<string>();

  if (postsWithTags.length > 0) {
    postsWithTags.forEach((post) =>
      post.data.tags?.forEach((t) => tagSet.add(t)),
    );
  }

  return tagSet.size === 0 ? null : [...tagSet].sort();
};
---

{
  blogPath && (
    <BaseLayout pageTitle={blogPath.label || "Blog"}>
      <main class="layout-base gap-8 py-8">
        <section class="flex flex-col gap-2">
          <Filter {allWritings} allTags={getTags()} client:only="react" />
          <CardDisplay data={allWritings} baseUrl={blogPath.path} client:load />
        </section>
      </main>
    </BaseLayout>
  )
}
